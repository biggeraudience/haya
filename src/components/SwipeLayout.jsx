import React, { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { useSwipeable } from 'react-swipeable';
import axios from 'axios';

axios.defaults.baseURL = 'http://localhost:5000/api';

const SwipeLayout = ({ handleAddToFavorites, handleBuyClick, filteredProducts, category }) => {
  const [currentIndex, setCurrentIndex] = useState(0);

  // Handle next and previous product navigation
  const nextProduct = () => {
    setCurrentIndex((prevIndex) => (prevIndex + 1) % filteredProducts.length);
  };

  const prevProduct = () => {
    setCurrentIndex((prevIndex) =>
      prevIndex === 0 ? filteredProducts.length - 1 : prevIndex - 1
    );
  };

  // Auto-scroll functionality every 5 seconds
  useEffect(() => {
    const interval = setInterval(nextProduct, 5000);
    return () => clearInterval(interval);
  }, [filteredProducts.length]);

  // Swipe handling functionality using react-swipeable
  const handlers = useSwipeable({
    onSwipedLeft: nextProduct,
    onSwipedRight: prevProduct,
    trackMouse: true,
  });

  return (
    <div className="container">
      <div className="swipe-layout-container" {...handlers}>
        {filteredProducts.length > 0 ? (
          // Filtered products based on category
          <div className="swipe-layout-wrapper">
            <button className="swipe-prev-button" onClick={prevProduct}>
              <svg
                width="40"
                height="40"
                viewBox="0 0 23 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M11.5 0L22.3253 18.75H0.674683L11.5 0Z" fill="black" />
                <path d="M11.5 5L17.9952 16.25H5.00481L11.5 5Z" fill="#FE5829" />
              </svg>
            </button>

            {/* Product Image */}
            <div className="swipe-product-image-container">
              <Link to={`/${filteredProducts[currentIndex].name}`}>
                <img
                  src={filteredProducts[currentIndex].images[0]}
                  alt={filteredProducts[currentIndex].name}
                  className="swipe-product-image"
                />
              </Link>
            </div>

            {/* Product Details */}
            <div className="swipe-product-details">
              <span className="swipe-product-price">
                {`$${filteredProducts[currentIndex].price}`}
              </span>
              <div className="swipe-product-actions">
                <button
                  className="swipe-favorites-button"
                  onClick={() =>
                    handleAddToFavorites(filteredProducts[currentIndex].name)
                  }
                >
                   <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7 12.8845L6.21244 12.2155C5.04042 11.206 4.07151 10.335 3.30572 9.60281C2.53982 8.87057 1.93002 8.21511 1.47631 7.63641C1.02248 7.05771 0.704669 6.53126 0.522869 6.05705C0.340956 5.58273 0.25 5.10135 0.25 4.61291C0.25 3.64197 0.594981 2.83116 1.28494 2.18047C1.97502 1.52978 2.83002 1.20444 3.84994 1.20444C4.47252 1.20444 5.05381 1.33892 5.59381 1.60788C6.13381 1.87695 6.60254 2.26276 7 2.76533C7.44246 2.24153 7.92807 1.8504 8.45682 1.59195C8.98557 1.33361 9.54998 1.20444 10.1501 1.20444C11.17 1.20444 12.025 1.52978 12.7151 2.18047C13.405 2.83116 13.75 3.64197 13.75 4.61291C13.75 5.10135 13.659 5.58273 13.4771 6.05705C13.2953 6.53126 12.9775 7.05771 12.5237 7.63641C12.07 8.21511 11.4602 8.87057 10.6943 9.60281C9.92849 10.335 8.95958 11.206 7.78756 12.2155L7 12.8845ZM7 11.4724C8.11926 10.5096 9.04036 9.68404 9.76328 8.99566C10.4861 8.30717 11.0594 7.70543 11.4832 7.19044C11.9069 6.67546 12.2031 6.21664 12.3718 5.81399C12.5406 5.41135 12.6249 5.01152 12.6249 4.6145C12.6249 3.93387 12.3925 3.37232 11.9275 2.92986C11.4625 2.4875 10.8709 2.26632 10.1526 2.26632C9.58986 2.26632 9.06904 2.42469 8.59013 2.74144C8.11133 3.05818 7.74256 3.49087 7.48381 4.03952H6.50506C6.25373 3.49799 5.88867 3.06705 5.40987 2.74669C4.93096 2.42645 4.41014 2.26632 3.84741 2.26632C3.1291 2.26632 2.53746 2.4875 2.0725 2.92986C1.60754 3.37232 1.37506 3.93445 1.37506 4.61625C1.37506 5.01401 1.45943 5.41549 1.62818 5.82068C1.79693 6.22598 2.09314 6.68788 2.51682 7.20637C2.94061 7.72497 3.51627 8.3267 4.24381 9.01158C4.97123 9.69646 5.88996 10.5167 7 11.4724Z" fill="#FE5829"/>
<path d="M7 12.8845L6.21244 12.2155C5.04042 11.206 4.07151 10.335 3.30572 9.60281C2.53982 8.87057 1.93002 8.21511 1.47631 7.63641C1.02248 7.05771 0.704669 6.53126 0.522869 6.05705C0.340956 5.58273 0.25 5.10135 0.25 4.61291C0.25 3.64197 0.594981 2.83116 1.28494 2.18047C1.97502 1.52978 2.83002 1.20444 3.84994 1.20444C4.47252 1.20444 5.05381 1.33892 5.59381 1.60788C6.13381 1.87695 6.60254 2.26276 7 2.76533C7.44246 2.24153 7.92807 1.8504 8.45682 1.59195C8.98557 1.33361 9.54998 1.20444 10.1501 1.20444C11.17 1.20444 12.025 1.52978 12.7151 2.18047C13.405 2.83116 13.75 3.64197 13.75 4.61291C13.75 5.10135 13.659 5.58273 13.4771 6.05705C13.2953 6.53126 12.9775 7.05771 12.5237 7.63641C12.07 8.21511 11.4602 8.87057 10.6943 9.60281C9.92849 10.335 8.95958 11.206 7.78756 12.2155L7 12.8845ZM7 11.4724C8.11926 10.5096 9.04036 9.68404 9.76328 8.99566C10.4861 8.30717 11.0594 7.70543 11.4832 7.19044C11.9069 6.67546 12.2031 6.21664 12.3718 5.81399C12.5406 5.41135 12.6249 5.01152 12.6249 4.6145C12.6249 3.93387 12.3925 3.37232 11.9275 2.92986C11.4625 2.4875 10.8709 2.26632 10.1526 2.26632C9.58986 2.26632 9.06904 2.42469 8.59013 2.74144C8.11133 3.05818 7.74256 3.49087 7.48381 4.03952H6.50506C6.25373 3.49799 5.88867 3.06705 5.40987 2.74669C4.93096 2.42645 4.41014 2.26632 3.84741 2.26632C3.1291 2.26632 2.53746 2.4875 2.0725 2.92986C1.60754 3.37232 1.37506 3.93445 1.37506 4.61625C1.37506 5.01401 1.45943 5.41549 1.62818 5.82068C1.79693 6.22598 2.09314 6.68788 2.51682 7.20637C2.94061 7.72497 3.51627 8.3267 4.24381 9.01158C4.97123 9.69646 5.88996 10.5167 7 11.4724Z" fill="#FE5829"/>
<path d="M6.75 12.727L6.02078 12.0579C4.93557 11.0482 4.03844 10.1771 3.32938 9.4448C2.62021 8.71245 2.05557 8.05688 1.63547 7.4781C1.21526 6.89932 0.92099 6.37278 0.752656 5.8985C0.584219 5.42411 0.5 4.94266 0.5 4.45415C0.5 3.48306 0.819427 2.67213 1.45828 2.02135C2.09724 1.37056 2.88891 1.04517 3.83328 1.04517C4.40974 1.04517 4.94797 1.17967 5.44797 1.44867C5.94797 1.71778 6.38198 2.10365 6.75 2.60629C7.15969 2.08241 7.60932 1.69123 8.09891 1.43274C8.58849 1.17436 9.11109 1.04517 9.66672 1.04517C10.6111 1.04517 11.4028 1.37056 12.0417 2.02135C12.6806 2.67213 13 3.48306 13 4.45415C13 4.94266 12.9158 5.42411 12.7473 5.8985C12.579 6.37278 12.2847 6.89932 11.8645 7.4781C11.4444 8.05688 10.8798 8.71245 10.1706 9.4448C9.46156 10.1771 8.56443 11.0482 7.47922 12.0579L6.75 12.727ZM6.75 11.3146C7.78635 10.3517 8.63922 9.52604 9.30859 8.83755C9.97786 8.14896 10.5087 7.54713 10.9011 7.03207C11.2934 6.517 11.5677 6.05812 11.7239 5.65541C11.8802 5.25271 11.9583 4.85281 11.9583 4.45574C11.9583 3.775 11.743 3.21337 11.3125 2.77084C10.882 2.32842 10.3342 2.10721 9.66906 2.10721C9.14802 2.10721 8.66578 2.2656 8.22234 2.58239C7.77901 2.89918 7.43755 3.33194 7.19797 3.88067H6.29172C6.05901 3.33906 5.72099 2.90805 5.27766 2.58765C4.83422 2.26735 4.35198 2.10721 3.83094 2.10721C3.16583 2.10721 2.61802 2.32842 2.1875 2.77084C1.75698 3.21337 1.54172 3.77559 1.54172 4.45749C1.54172 4.85531 1.61984 5.25685 1.77609 5.6621C1.93234 6.06746 2.20661 6.52943 2.59891 7.048C2.9913 7.56667 3.52432 8.1685 4.19797 8.85348C4.87151 9.53846 5.72219 10.3588 6.75 11.3146Z" fill="black"/>
<path d="M6.5 11.2387L2 6.65162L1 4.61291L2 2.5742L3 2.06452H4.5L5.5 2.5742L6 3.08388L6.5 4.10323H7.5L8 3.08388L8.5 2.5742L9.5 2.06452H10.5L11.5 2.5742L12 3.59355V4.61291L11.5 6.14194L11 7.16129L7 11.2387H6.5Z" fill="#FE5829"/>
<path d="M6.5 11.2387L2 6.65162L1 4.61291L2 2.5742L3 2.06452H4.5L5.5 2.5742L6 3.08388L6.5 4.10323H7.5L8 3.08388L8.5 2.5742L9.5 2.06452H10.5L11.5 2.5742L12 3.59355V4.61291L11.5 6.14194L11 7.16129L7 11.2387H6.5Z" fill="#FE5829"/>
<path d="M7 12.8845L6.21244 12.2155C5.04042 11.206 4.07151 10.335 3.30572 9.60281C2.53982 8.87057 1.93002 8.21511 1.47631 7.63641C1.02248 7.05771 0.704669 6.53126 0.522869 6.05705C0.340956 5.58273 0.25 5.10135 0.25 4.61291C0.25 3.64197 0.594981 2.83116 1.28494 2.18047C1.97502 1.52978 2.83002 1.20444 3.84994 1.20444C4.47252 1.20444 5.05381 1.33892 5.59381 1.60788C6.13381 1.87695 6.60254 2.26276 7 2.76533C7.44246 2.24153 7.92807 1.8504 8.45682 1.59195C8.98557 1.33361 9.54998 1.20444 10.1501 1.20444C11.17 1.20444 12.025 1.52978 12.7151 2.18047C13.405 2.83116 13.75 3.64197 13.75 4.61291C13.75 5.10135 13.659 5.58273 13.4771 6.05705C13.2953 6.53126 12.9775 7.05771 12.5237 7.63641C12.07 8.21511 11.4602 8.87057 10.6943 9.60281C9.92849 10.335 8.95958 11.206 7.78756 12.2155L7 12.8845ZM7 11.4724C8.11926 10.5096 9.04036 9.68404 9.76328 8.99566C10.4861 8.30717 11.0594 7.70543 11.4832 7.19044C11.9069 6.67546 12.2031 6.21664 12.3718 5.81399C12.5406 5.41135 12.6249 5.01152 12.6249 4.6145C12.6249 3.93387 12.3925 3.37232 11.9275 2.92986C11.4625 2.4875 10.8709 2.26632 10.1526 2.26632C9.58986 2.26632 9.06904 2.42469 8.59013 2.74144C8.11133 3.05818 7.74256 3.49087 7.48381 4.03952H6.50506C6.25373 3.49799 5.88867 3.06705 5.40987 2.74669C4.93096 2.42645 4.41014 2.26632 3.84741 2.26632C3.1291 2.26632 2.53746 2.4875 2.0725 2.92986C1.60754 3.37232 1.37506 3.93445 1.37506 4.61625C1.37506 5.01401 1.45943 5.41549 1.62818 5.82068C1.79693 6.22598 2.09314 6.68788 2.51682 7.20637C2.94061 7.72497 3.51627 8.3267 4.24381 9.01158C4.97123 9.69646 5.88996 10.5167 7 11.4724Z" stroke="black" strokeWidth="0.5"/>
<path d="M7 12.8845L6.21244 12.2155C5.04042 11.206 4.07151 10.335 3.30572 9.60281C2.53982 8.87057 1.93002 8.21511 1.47631 7.63641C1.02248 7.05771 0.704669 6.53126 0.522869 6.05705C0.340956 5.58273 0.25 5.10135 0.25 4.61291C0.25 3.64197 0.594981 2.83116 1.28494 2.18047C1.97502 1.52978 2.83002 1.20444 3.84994 1.20444C4.47252 1.20444 5.05381 1.33892 5.59381 1.60788C6.13381 1.87695 6.60254 2.26276 7 2.76533C7.44246 2.24153 7.92807 1.8504 8.45682 1.59195C8.98557 1.33361 9.54998 1.20444 10.1501 1.20444C11.17 1.20444 12.025 1.52978 12.7151 2.18047C13.405 2.83116 13.75 3.64197 13.75 4.61291C13.75 5.10135 13.659 5.58273 13.4771 6.05705C13.2953 6.53126 12.9775 7.05771 12.5237 7.63641C12.07 8.21511 11.4602 8.87057 10.6943 9.60281C9.92849 10.335 8.95958 11.206 7.78756 12.2155L7 12.8845ZM7 11.4724C8.11926 10.5096 9.04036 9.68404 9.76328 8.99566C10.4861 8.30717 11.0594 7.70543 11.4832 7.19044C11.9069 6.67546 12.2031 6.21664 12.3718 5.81399C12.5406 5.41135 12.6249 5.01152 12.6249 4.6145C12.6249 3.93387 12.3925 3.37232 11.9275 2.92986C11.4625 2.4875 10.8709 2.26632 10.1526 2.26632C9.58986 2.26632 9.06904 2.42469 8.59013 2.74144C8.11133 3.05818 7.74256 3.49087 7.48381 4.03952H6.50506C6.25373 3.49799 5.88867 3.06705 5.40987 2.74669C4.93096 2.42645 4.41014 2.26632 3.84741 2.26632C3.1291 2.26632 2.53746 2.4875 2.0725 2.92986C1.60754 3.37232 1.37506 3.93445 1.37506 4.61625C1.37506 5.01401 1.45943 5.41549 1.62818 5.82068C1.79693 6.22598 2.09314 6.68788 2.51682 7.20637C2.94061 7.72497 3.51627 8.3267 4.24381 9.01158C4.97123 9.69646 5.88996 10.5167 7 11.4724Z" stroke="black" strokeWidth="0.5"/>
<path d="M6.75 12.727L6.02078 12.0579C4.93557 11.0482 4.03844 10.1771 3.32938 9.4448C2.62021 8.71245 2.05557 8.05688 1.63547 7.4781C1.21526 6.89932 0.92099 6.37278 0.752656 5.8985C0.584219 5.42411 0.5 4.94266 0.5 4.45415C0.5 3.48306 0.819427 2.67213 1.45828 2.02135C2.09724 1.37056 2.88891 1.04517 3.83328 1.04517C4.40974 1.04517 4.94797 1.17967 5.44797 1.44867C5.94797 1.71778 6.38198 2.10365 6.75 2.60629C7.15969 2.08241 7.60932 1.69123 8.09891 1.43274C8.58849 1.17436 9.11109 1.04517 9.66672 1.04517C10.6111 1.04517 11.4028 1.37056 12.0417 2.02135C12.6806 2.67213 13 3.48306 13 4.45415C13 4.94266 12.9158 5.42411 12.7473 5.8985C12.579 6.37278 12.2847 6.89932 11.8645 7.4781C11.4444 8.05688 10.8798 8.71245 10.1706 9.4448C9.46156 10.1771 8.56443 11.0482 7.47922 12.0579L6.75 12.727ZM6.75 11.3146C7.78635 10.3517 8.63922 9.52604 9.30859 8.83755C9.97786 8.14896 10.5087 7.54713 10.9011 7.03207C11.2934 6.517 11.5677 6.05812 11.7239 5.65541C11.8802 5.25271 11.9583 4.85281 11.9583 4.45574C11.9583 3.775 11.743 3.21337 11.3125 2.77084C10.882 2.32842 10.3342 2.10721 9.66906 2.10721C9.14802 2.10721 8.66578 2.2656 8.22234 2.58239C7.77901 2.89918 7.43755 3.33194 7.19797 3.88067H6.29172C6.05901 3.33906 5.72099 2.90805 5.27766 2.58765C4.83422 2.26735 4.35198 2.10721 3.83094 2.10721C3.16583 2.10721 2.61802 2.32842 2.1875 2.77084C1.75698 3.21337 1.54172 3.77559 1.54172 4.45749C1.54172 4.85531 1.61984 5.25685 1.77609 5.6621C1.93234 6.06746 2.20661 6.52943 2.59891 7.048C2.9913 7.56667 3.52432 8.1685 4.19797 8.85348C4.87151 9.53846 5.72219 10.3588 6.75 11.3146Z" stroke="black" strokeWidth="0.5"/>
<path d="M6.5 11.2387L2 6.65162L1 4.61291L2 2.5742L3 2.06452H4.5L5.5 2.5742L6 3.08388L6.5 4.10323H7.5L8 3.08388L8.5 2.5742L9.5 2.06452H10.5L11.5 2.5742L12 3.59355V4.61291L11.5 6.14194L11 7.16129L7 11.2387H6.5Z" stroke="black" strokeWidth="0.5"/>
<path d="M6.5 11.2387L2 6.65162L1 4.61291L2 2.5742L3 2.06452H4.5L5.5 2.5742L6 3.08388L6.5 4.10323H7.5L8 3.08388L8.5 2.5742L9.5 2.06452H10.5L11.5 2.5742L12 3.59355V4.61291L11.5 6.14194L11 7.16129L7 11.2387H6.5Z" stroke="black" strokeWidth="0.5"/>

                          </svg>
                          
                </button>
                <button
                  className="swipe-buy-button"
                  onClick={() => handleBuyClick(filteredProducts[currentIndex])} 
                >
                  Buy
                </button>
              </div>
            </div>
          </div>
        ) : (
          <p>No products available</p>
        )}
      </div>
    </div>
  );
};

export default SwipeLayout;
