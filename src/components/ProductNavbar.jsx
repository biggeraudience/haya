import React, { useState, useEffect, useContext } from "react";
import { Link } from "react-router-dom";
import { useCartContext } from "../context/CartContextContext";
import { useMessageContext } from "../context/MessageContext"; // Import MessageContext

const ProductNavbar = () => {
  const { cartItems } = useCartContext(); // Access cartItems from CartContext
  const { unreadCount } = useMessageContext(); // Access unreadCount from MessageContext
  const [itemCount, setItemCount] = useState(0);

  // Update the item count whenever cartItems change
  useEffect(() => {
    const totalItems = cartItems.reduce((acc, item) => acc + item.quantity, 0);
    setItemCount(totalItems);
  }, [cartItems]); // Dependency on cartItems to recalculate when it changes

  return (
    <div className="product-navbar">
      {/* Logo styled in CSS */}
      <Link to="/" className="button-container">
        <div className="product-navbar-logo"></div>
      </Link>

      {/* Icons container */}
      <div className="product-navbar-icons">
        <div className="product-search-bar">
          <input type="text" placeholder="SEARCH" />
        </div>

        {/* Favorite Icon */}
        <Link to="/Favorites" className="icon favorite-icon">
        <span className="icon favorite">
            {/* Favorite icon */}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.8 20.9832L11.5399 19.9332C9.66467 18.3485 8.11442 16.9815 6.88916 15.8322C5.66372 14.6828 4.68803 13.654 3.96209 12.7457C3.23597 11.8373 2.72747 11.011 2.43659 10.2667C2.14553 9.52215 2 8.76657 2 7.9999C2 6.4759 2.55197 5.20324 3.65591 4.1819C4.76003 3.16057 6.12803 2.6499 7.75991 2.6499C8.75603 2.6499 9.68609 2.86099 10.5501 3.28315C11.4141 3.70549 12.1641 4.31107 12.8 5.0999C13.5079 4.27774 14.2849 3.66382 15.1309 3.25815C15.9769 2.85265 16.88 2.6499 17.8401 2.6499C19.472 2.6499 20.84 3.16057 21.9441 4.1819C23.048 5.20324 23.6 6.4759 23.6 7.9999C23.6 8.76657 23.4545 9.52215 23.1634 10.2667C22.8725 11.011 22.364 11.8373 21.6379 12.7457C20.912 13.654 19.9363 14.6828 18.7108 15.8322C17.4856 16.9815 15.9353 18.3485 14.0601 19.9332L12.8 20.9832ZM12.8 18.7667C14.5908 17.2555 16.0646 15.9597 17.2213 14.8792C18.3778 13.7985 19.295 12.854 19.9731 12.0457C20.651 11.2373 21.1249 10.5172 21.3949 9.88515C21.6649 9.25315 21.7999 8.62557 21.7999 8.0024C21.7999 6.93407 21.4279 6.05265 20.684 5.35815C19.9401 4.66382 18.9934 4.31665 17.8441 4.31665C16.9438 4.31665 16.1105 4.56524 15.3442 5.0624C14.5781 5.55957 13.9881 6.23874 13.5741 7.0999H12.0081C11.606 6.2499 11.0219 5.57349 10.2558 5.07065C9.48953 4.56799 8.65622 4.31665 7.75586 4.31665C6.60656 4.31665 5.65994 4.66382 4.916 5.35815C4.17206 6.05265 3.80009 6.93499 3.80009 8.00515C3.80009 8.62949 3.93509 9.25965 4.20509 9.89565C4.47509 10.5318 4.94903 11.2568 5.62691 12.0707C6.30497 12.8847 7.22603 13.8292 8.39009 14.9042C9.55397 15.9792 11.0239 17.2667 12.8 18.7667Z" fill="#FE5829"/>
            <path d="M12.4 20.7359L11.2333 19.6857C9.49694 18.1008 8.06152 16.7336 6.92702 15.5841C5.79236 14.4346 4.88894 13.4056 4.21677 12.4972C3.54444 11.5887 3.07361 10.7622 2.80427 10.0178C2.53477 9.27318 2.40002 8.51749 2.40002 7.7507C2.40002 6.22648 2.91111 4.95362 3.93327 3.93213C4.95561 2.91065 6.22227 2.3999 7.73327 2.3999C8.65561 2.3999 9.51678 2.61102 10.3168 3.03325C11.1168 3.45564 11.8112 4.06132 12.4 4.85027C13.0555 4.02798 13.7749 3.41397 14.5583 3.00824C15.3416 2.60268 16.1778 2.3999 17.0668 2.3999C18.5778 2.3999 19.8444 2.91065 20.8668 3.93213C21.8889 4.95362 22.4 6.22648 22.4 7.7507C22.4 8.51749 22.2653 9.27318 21.9958 10.0178C21.7264 10.7622 21.2556 11.5887 20.5833 12.4972C19.9111 13.4056 19.0077 14.4346 17.873 15.5841C16.7385 16.7336 15.3031 18.1008 13.5668 19.6857L12.4 20.7359ZM12.4 18.5191C14.0582 17.0077 15.4228 15.7116 16.4938 14.631C17.5646 13.5502 18.4139 12.6055 19.0418 11.7971C19.6694 10.9886 20.1083 10.2683 20.3583 9.63624C20.6083 9.00414 20.7333 8.37646 20.7333 7.7532C20.7333 6.68471 20.3889 5.80316 19.7 5.10856C19.0112 4.41412 18.1347 4.0669 17.0705 4.0669C16.2369 4.0669 15.4653 4.31552 14.7558 4.81276C14.0464 5.31001 13.5001 5.98927 13.1168 6.85057H11.6668C11.2944 6.00044 10.7536 5.32392 10.0443 4.82102C9.33477 4.31827 8.56319 4.0669 7.72952 4.0669C6.66536 4.0669 5.78886 4.41412 5.10002 5.10856C4.41119 5.80316 4.06677 6.68563 4.06677 7.75596C4.06677 8.38038 4.19177 9.01064 4.44177 9.64674C4.69177 10.283 5.13061 11.0081 5.75827 11.8221C6.38611 12.6362 7.23894 13.5808 8.31677 14.656C9.39444 15.7312 10.7555 17.0188 12.4 18.5191Z" fill="black"/>
            </svg>
          </span>
        </Link>

        {/* Message Icon with unread count */}
        <Link to="/Notifications" className="icon messages-icon">
        <svg width="22" height="24" viewBox="0 0 23 29" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.9 15C1.3775 15 0.930208 14.8164 0.558125 14.4492C0.186042 14.082 0 13.6406 0 13.125V1.875C0 1.35937 0.186042 0.917969 0.558125 0.550781C0.930208 0.183594 1.3775 0 1.9 0H17.1C17.6225 0 18.0698 0.183594 18.4419 0.550781C18.814 0.917969 19 1.35937 19 1.875V13.125C19 13.6406 18.814 14.082 18.4419 14.4492C18.0698 14.8164 17.6225 15 17.1 15H1.9ZM9.5 8.4375L1.9 3.75V13.125H17.1V3.75L9.5 8.4375ZM9.5 6.5625L17.1 1.875H1.9L9.5 6.5625ZM1.9 3.75V1.875V13.125V3.75Z" fill="#FE5829"/>
          <path d="M1.80952 15C1.3119 15 0.885913 14.8272 0.531548 14.4816C0.177183 14.136 0 13.7206 0 13.2353V2.64706C0 2.16176 0.177183 1.74632 0.531548 1.40074C0.885913 1.05515 1.3119 0.882353 1.80952 0.882353H16.2857C16.7833 0.882353 17.2093 1.05515 17.5637 1.40074C17.9181 1.74632 18.0952 2.16176 18.0952 2.64706V13.2353C18.0952 13.7206 17.9181 14.136 17.5637 14.4816C17.2093 14.8272 16.7833 15 16.2857 15H1.80952ZM9.04762 8.82353L1.80952 4.41176V13.2353H16.2857V4.41176L9.04762 8.82353ZM9.04762 7.05882L16.2857 2.64706H1.80952L9.04762 7.05882ZM1.80952 4.41176V2.64706V13.2353V4.41176Z" fill="black"/>
          </svg>

          {unreadCount > 0 && (
            <span className="item-count-message">{unreadCount}</span>
          )}
        </Link>

        {/* Profile Icon */}
        <Link to="/Profile" className="icon profile-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.3 12.7767C13.8837 12.7767 12.7071 12.3127 11.77 11.3847C10.8331 10.4566 10.3647 9.29111 10.3647 7.88834C10.3647 6.48557 10.8331 5.3201 11.77 4.39193C12.7071 3.46398 13.8837 3 15.3 3C16.7162 3 17.8929 3.46398 18.83 4.39193C19.7669 5.3201 20.2353 6.48557 20.2353 7.88834C20.2353 9.29111 19.7669 10.4566 18.83 11.3847C17.8929 12.3127 16.7162 12.7767 15.3 12.7767ZM5 23V19.8119C5 19.0325 5.19849 18.3506 5.59547 17.7661C5.99245 17.1816 6.50927 16.7371 7.14594 16.4325C8.54781 15.7878 9.9175 15.3043 11.255 14.9819C12.5927 14.6595 13.941 14.4983 15.3 14.4983C16.659 14.4983 18.0036 14.663 19.3341 14.9924C20.6645 15.3219 22.0301 15.8033 23.4309 16.4366C24.0862 16.7431 24.6115 17.1874 25.0068 17.7696C25.4023 18.3517 25.6 19.0325 25.6 19.8119V23H5ZM7.14594 20.8745H23.4541V19.8119C23.4541 19.5073 23.3665 19.2204 23.1914 18.9511C23.0161 18.6818 22.7961 18.4799 22.5316 18.3454C21.2297 17.7147 20.0029 17.2702 18.8512 17.0118C17.6998 16.7531 16.516 16.6238 15.3 16.6238C14.084 16.6238 12.893 16.7531 11.7272 17.0118C10.5614 17.2702 9.33469 17.7147 8.04719 18.3454C7.78239 18.4799 7.56599 18.6818 7.39797 18.9511C7.22995 19.2204 7.14594 19.5073 7.14594 19.8119V20.8745ZM15.3 10.6515C16.094 10.6515 16.7573 10.3875 17.2902 9.85955C17.8232 9.33181 18.0897 8.67474 18.0897 7.88834C18.0897 7.10194 17.8232 6.44486 17.2902 5.91712C16.7573 5.38917 16.094 5.1252 15.3 5.1252C14.506 5.1252 13.8427 5.38917 13.3098 5.91712C12.7768 6.44486 12.5103 7.10194 12.5103 7.88834C12.5103 8.67474 12.7768 9.33181 13.3098 9.85955C13.8427 10.3875 14.506 10.6515 15.3 10.6515Z" fill="#FE5829"/>
          <path d="M14 12.5811C12.625 12.5811 11.4826 12.1264 10.5728 11.217C9.66323 10.3074 9.20844 9.16528 9.20844 7.79057C9.20844 6.41585 9.66323 5.2737 10.5728 4.36409C11.4826 3.4547 12.625 3 14 3C15.375 3 16.5174 3.4547 17.4272 4.36409C18.3368 5.2737 18.7916 6.41585 18.7916 7.79057C18.7916 9.16528 18.3368 10.3074 17.4272 11.217C16.5174 12.1264 15.375 12.5811 14 12.5811ZM4 22.6V19.4756C4 18.7118 4.19271 18.0435 4.57812 17.4708C4.96354 16.898 5.46531 16.4623 6.08344 16.1638C7.44448 15.5321 8.77427 15.0582 10.0728 14.7423C11.3716 14.4263 12.6806 14.2683 14 14.2683C15.3194 14.2683 16.6249 14.4297 17.9166 14.7526C19.2082 15.0754 20.5341 15.5472 21.8941 16.1679C22.5303 16.4683 23.0403 16.9037 23.4241 17.4742C23.808 18.0447 24 18.7118 24 19.4756V22.6H4ZM6.08344 20.517H21.9166V19.4756C21.9166 19.1772 21.8316 18.896 21.6616 18.6321C21.4914 18.3682 21.2778 18.1703 21.0209 18.0384C19.757 17.4204 18.5659 16.9848 17.4478 16.7315C16.3299 16.478 15.1806 16.3513 14 16.3513C12.8194 16.3513 11.6631 16.478 10.5312 16.7315C9.39937 16.9848 8.20844 17.4204 6.95844 18.0384C6.70135 18.1703 6.49125 18.3682 6.32812 18.6321C6.165 18.896 6.08344 19.1772 6.08344 19.4756V20.517ZM14 10.4984C14.7708 10.4984 15.4149 10.2398 15.9322 9.72236C16.4497 9.20517 16.7084 8.56124 16.7084 7.79057C16.7084 7.0199 16.4497 6.37597 15.9322 5.85878C15.4149 5.34139 14.7708 5.08269 14 5.08269C13.2292 5.08269 12.5851 5.34139 12.0678 5.85878C11.5503 6.37597 11.2916 7.0199 11.2916 7.79057C11.2916 8.56124 11.5503 9.20517 12.0678 9.72236C12.5851 10.2398 13.2292 10.4984 14 10.4984Z" fill="black"/>
          </svg>
        </Link>

        {/* Cart Icon with item count */}
        <div className="icon shopping-bag">
          <Link to="/Cart">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M2.29178 25.5C1.67303 25.5 1.13632 25.2934 0.681656 24.8803C0.227219 24.467 0 23.9791 0 23.4166V7.58344C0 7.02094 0.227219 6.53302 0.681656 6.11969C1.13632 5.70656 1.67303 5.5 2.29178 5.5H5.72928V5.29156C5.72928 3.95823 6.24101 2.82635 7.26447 1.89594C8.28816 0.965312 9.53333 0.5 11 0.5C12.4667 0.5 13.7118 0.965312 14.7355 1.89594C15.759 2.82635 16.2707 3.95823 16.2707 5.29156V5.5H19.7082C20.327 5.5 20.8637 5.70656 21.3183 6.11969C21.7728 6.53302 22 7.02094 22 7.58344V23.4166C22 23.9791 21.7728 24.467 21.3183 24.8803C20.8637 25.2934 20.327 25.5 19.7082 25.5H2.29178ZM2.29178 23.4166H19.7082V7.58344H16.2707V10.2916C16.2707 10.5868 16.1606 10.8342 15.9404 11.0338C15.7199 11.2335 15.4468 11.3334 15.1209 11.3334C14.7952 11.3334 14.5236 11.2335 14.3058 11.0338C14.0881 10.8342 13.9793 10.5868 13.9793 10.2916V7.58344H8.02072V10.2916C8.02072 10.5868 7.9106 10.8342 7.69038 11.0338C7.46992 11.2335 7.19675 11.3334 6.87088 11.3334C6.54523 11.3334 6.27355 11.2335 6.05584 11.0338C5.83814 10.8342 5.72928 10.5868 5.72928 10.2916V7.58344H2.29178V23.4166ZM8.02072 5.5H13.9793V5.29156C13.9793 4.53469 13.6909 3.89406 13.1141 3.36969C12.5373 2.84552 11.8326 2.58344 11 2.58344C10.1674 2.58344 9.46275 2.84552 8.88594 3.36969C8.30912 3.89406 8.02072 4.53469 8.02072 5.29156V5.5Z" fill="#FE5829"/>
          <path d="M2.08344 25C1.52094 25 1.03302 24.7934 0.619688 24.3803C0.206563 23.967 4.76837e-07 23.4791 4.76837e-07 22.9166V7.08344C4.76837e-07 6.52094 0.206563 6.03302 0.619688 5.61969C1.03302 5.20656 1.52094 5 2.08344 5H5.20844V4.79156C5.20844 3.45823 5.67365 2.32635 6.60406 1.39594C7.53469 0.465312 8.66667 0 10 0C11.3333 0 12.4653 0.465312 13.3959 1.39594C14.3264 2.32635 14.7916 3.45823 14.7916 4.79156V5H17.9166C18.4791 5 18.967 5.20656 19.3803 5.61969C19.7934 6.03302 20 6.52094 20 7.08344V22.9166C20 23.4791 19.7934 23.967 19.3803 24.3803C18.967 24.7934 18.4791 25 17.9166 25H2.08344ZM2.08344 22.9166H17.9166V7.08344H14.7916V9.79156C14.7916 10.0868 14.6915 10.3342 14.4912 10.5338C14.2908 10.7335 14.0425 10.8334 13.7463 10.8334C13.4502 10.8334 13.2032 10.7335 13.0053 10.5338C12.8074 10.3342 12.7084 10.0868 12.7084 9.79156V7.08344H7.29156V9.79156C7.29156 10.0868 7.19146 10.3342 6.99125 10.5338C6.79083 10.7335 6.5425 10.8334 6.24625 10.8334C5.95021 10.8334 5.70323 10.7335 5.50531 10.5338C5.3074 10.3342 5.20844 10.0868 5.20844 9.79156V7.08344H2.08344V22.9166ZM7.29156 5H12.7084V4.79156C12.7084 4.03469 12.4463 3.39406 11.9219 2.86969C11.3975 2.34552 10.7569 2.08344 10 2.08344C9.24313 2.08344 8.6025 2.34552 8.07812 2.86969C7.55375 3.39406 7.29156 4.03469 7.29156 4.79156V5Z" fill="black"/>
          </svg>

            {itemCount > 0 && (
              <span className="item-count">{itemCount}</span>
            )}
          </Link>
        </div>
      </div>
    </div>
  );
};

export default ProductNavbar;
